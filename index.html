<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Destiny 2 Armor 3.0 Calculator</title>
<style>
  body { font-family: Arial, sans-serif; background: #d0e7f9; margin: 20px; }
  .section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 0 8px rgba(0,0,0,0.1);}
  label { display: block; margin-top: 10px; }
  input[type=number], select { padding: 6px; font-size: 16px; width: 100%; max-width: 200px; }
  button { margin-top: 15px; padding: 10px 15px; font-size: 16px; cursor: pointer; }
  .flex-row { display: flex; flex-wrap: wrap; gap: 10px; }
  .flex-col { flex: 1 1 120px; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
  }
  th {
    background: #e0f0ff;
  }
  .inline-label {
    margin-left: 5px;
    font-weight: normal;
  }
</style>
</head>
<body>

<div class="section">
  <h1>Destiny 2 Armor 3.0 Stat Calculator</h1>
  <p>Calculate your optimal armor builds by selecting your class, desired stats, and customizing armor tiers and archetypes.</p>
</div>

<!-- Armor Archetype Breakdown Section -->
<div class="section">
  <h2>üõ°Ô∏è Armor Archetype Breakdown</h2>
  <table>
    <thead>
      <tr>
        <th>Archetype</th>
        <th>Primary Stat Focus</th>
        <th>Secondary Stat Focus</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Paragon</strong></td>
        <td>Super</td>
        <td>Melee</td>
        <td>Boosts Super and Melee regeneration stats, ideal for builds centered on powerful Super abilities and close-range combat.</td>
      </tr>
      <tr>
        <td><strong>Gunner</strong></td>
        <td>Weapons</td>
        <td>Grenade</td>
        <td>Focuses on weapon handling and grenade regeneration. Perfect for aggressive weapon and grenade spammers.</td>
      </tr>
      <tr>
        <td><strong>Brawler</strong></td>
        <td>Melee</td>
        <td>Health</td>
        <td>Strengthens Melee attacks and overall health. Great for tanky melee-focused builds.</td>
      </tr>
      <tr>
        <td><strong>Bulwark</strong></td>
        <td>Health</td>
        <td>Class</td>
        <td>Increases durability and class ability recharge, suited for defensive and support roles.</td>
      </tr>
      <tr>
        <td><strong>Grenadier</strong></td>
        <td>Grenade</td>
        <td>Super</td>
        <td>Prioritizes grenade and Super energy, enabling frequent use of both grenades and Supers.</td>
      </tr>
      <tr>
        <td><strong>Specialist</strong></td>
        <td>Class</td>
        <td>Weapons</td>
        <td>Enhances class ability recharge and weapon handling. Ideal for builds that rely heavily on class skills and weapons.</td>
      </tr>
    </tbody>
  </table>
  <p style="margin-top: 10px; font-style: italic;">
    ‚ö†Ô∏è <em>Note:</em> Actual stat gains vary by armor tier and Masterwork bonuses, so combining archetypes strategically can help you hit your desired stats efficiently.
  </p>
</div>

<div class="section" id="statCalcSection">
  <h2>Stat Calculator (Desired Stats Input)</h2>
  <div class="flex-row" id="statInputs"></div>
  <button id="calcSuggested">Calculate Suggested Build</button>
  <p id="suggestedBuildOutput"></p>
</div>

<div class="section" id="tertiaryModeSection">
  <h3>Tertiary Stat Selection Mode</h3>
  <label><input type="radio" name="tertiaryMode" value="global" checked /> Use Global Tertiary Stat</label>
  <label><input type="radio" name="tertiaryMode" value="perPiece" /> Set Tertiary Stat Per Armor Piece</label>
  <div id="globalTertiarySelector" style="margin-top:10px;">
    <label for="globalTertiary">Select Global Tertiary Stat:</label>
    <select id="globalTertiary"></select>
  </div>
</div>

<div class="section" id="customBuilderSection">
  <h2>Custom Tier/Archetype Builder</h2>
  <label for="classSelect">Class:</label>
  <select id="classSelect">
    <option>Hunter</option>
    <option>Titan</option>
    <option>Warlock</option>
  </select>

  <div id="armorSlots"></div>

  <label style="display:block; margin-top:15px;">
    <input type="checkbox" id="masterworkToggle" checked /> Include Masterwork Bonus (+5 to 3 non-primary/secondary/tertiary stats)
  </label>

  <h3>Estimated Total Stats:</h3>
  <ul id="totalStats"></ul>
</div>

<script>
  const TIERS = [1,2,3,4,5];
  const ARCHETYPES = ['Paragon','Gunner','Brawler','Bulwark','Grenadier','Specialist'];
  const CLASSES = ['Hunter','Titan','Warlock'];
  const STATS = ['Weapon', 'Health', 'Class', 'Grenade', 'Super', 'Melee'];

  // Archetype stat focus map
  const ARCHETYPE_STATS = {
    'Paragon': { primary: 'Super', secondary: 'Melee' },
    'Gunner': { primary: 'Weapon', secondary: 'Grenade' },
    'Brawler': { primary: 'Melee', secondary: 'Health' },
    'Bulwark': { primary: 'Health', secondary: 'Class' },
    'Grenadier': { primary: 'Grenade', secondary: 'Super' },
    'Specialist': { primary: 'Class', secondary: 'Weapon' }
  };

  // Tier stats based on the provided guide (approximate)
  const TIER_STATS = {
    1: { primary: 16, secondary: 12, tertiary: 7 },
    2: { primary: 20, secondary: 15, tertiary: 10 },
    3: { primary: 24, secondary: 18, tertiary: 13 },
    4: { primary: 30, secondary: 25, tertiary: 18 },
    5: { primary: 32, secondary: 28, tertiary: 21 }
  };

  // Build state
  let buildSlots = [];
  let desiredStats = {};
  let tertiaryMode = 'global';
  let selectedGlobalTertiaryStat = 'Health';

  // Create stat inputs for desired stats calculator
  const statInputsContainer = document.getElementById('statInputs');
  STATS.forEach(stat => {
    desiredStats[stat] = 0;
    const div = document.createElement('div');
    div.className = 'flex-col';
    div.innerHTML = `<label>${stat} (0‚Äì200)</label><input type="number" min="0" max="200" value="0" id="stat_${stat}" />`;
    statInputsContainer.appendChild(div);
  });

  STATS.forEach(stat => {
    document.getElementById(`stat_${stat}`).addEventListener('input', e => {
      let val = parseInt(e.target.value);
      if(isNaN(val) || val < 0) val = 0;
      else if(val > 200) val = 200;
      desiredStats[stat] = val;
    });
  });

  // Global tertiary selector options
  const globalTertiarySelector = document.getElementById('globalTertiary');
  STATS.forEach(stat => {
    const option = document.createElement('option');
    option.value = stat;
    option.textContent = stat;
    globalTertiarySelector.appendChild(option);
  });
  globalTertiarySelector.value = selectedGlobalTertiaryStat;
  globalTertiarySelector.addEventListener('change', () => {
    selectedGlobalTertiaryStat = globalTertiarySelector.value;
    updateTotalStats();
  });

  // Handle tertiary mode radio buttons
  const tertiaryModeRadios = document.querySelectorAll('input[name="tertiaryMode"]');
  tertiaryModeRadios.forEach(radio => {
    radio.addEventListener('change', () => {
      tertiaryMode = document.querySelector('input[name="tertiaryMode"]:checked').value;
      renderArmorSlots(); // re-render to show/hide tertiary selector per piece
      updateTotalStats();
      document.getElementById('globalTertiarySelector').style.display = (tertiaryMode === 'global') ? 'block' : 'none';
    });
  });

  // Masterwork toggle
  const masterworkToggle = document.getElementById('masterworkToggle');
  masterworkToggle.addEventListener('change', () => {
    updateTotalStats();
  });

  // Calculate suggested build button (placeholder logic)
  document.getElementById('calcSuggested').addEventListener('click', () => {
    document.getElementById('suggestedBuildOutput').textContent =
      'Suggested build: 2x T5 Paragon, 2x T4 Gunner, 1x T3 Brawler';
  });

  // Armor slots container
  const armorSlotsDiv = document.getElementById('armorSlots');
  const slotNames = ['Helmet', 'Gauntlets', 'Chest', 'Legs', 'Class Item'];

  // Initialize build slots
  function initBuildSlots() {
    buildSlots = [];
    for(let i=0; i<5; i++) {
      buildSlots.push({
        tier: 5,
        archetype: ARCHETYPES[0],
        tertiaryStat: STATS[0]  // default tertiary stat per piece
      });
    }
  }

  // Render armor slots UI
  function renderArmorSlots() {
    armorSlotsDiv.innerHTML = '';
    buildSlots.forEach((slot, i) => {
      const div = document.createElement('div');
      div.style.marginBottom = '12px';
      div.style.display = 'flex';
      div.style.gap = '10px';
      div.style.alignItems = 'center';

      const label = document.createElement('div');
      label.style.width = '100px';
      label.textContent = slotNames[i];
      div.appendChild(label);

      // Tier select
      const tierSelect = document.createElement('select');
      TIERS.forEach(t => {
        const opt = document.createElement('option');
        opt.value = t;
        opt.textContent = 'Tier ' + t;
        tierSelect.appendChild(opt);
      });
      tierSelect.value = slot.tier;
      div.appendChild(tierSelect);

      // Archetype select
      const archetypeSelect = document.createElement('select');
      ARCHETYPES.forEach(a => {
        const opt = document.createElement('option');
        opt.value = a;
        opt.textContent = a;
        archetypeSelect.appendChild(opt);
      });
      archetypeSelect.value = slot.archetype;
      div.appendChild(archetypeSelect);

      // Tertiary stat select (only visible if per-piece mode)
      const tertiarySelect = document.createElement('select');
      STATS.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s;
        opt.textContent = s;
        tertiarySelect.appendChild(opt);
      });
      tertiarySelect.value = slot.tertiaryStat;
      tertiarySelect.style.display = (tertiaryMode === 'perPiece') ? 'inline-block' : 'none';
      div.appendChild(tertiarySelect);

      tierSelect.addEventListener('change', () => {
        buildSlots[i].tier = Number(tierSelect.value);
        updateTotalStats();
      });
      archetypeSelect.addEventListener('change', () => {
        buildSlots[i].archetype = archetypeSelect.value;
        updateTotalStats();
      });
      tertiarySelect.addEventListener('change', () => {
        buildSlots[i].tertiaryStat = tertiarySelect.value;
        updateTotalStats();
      });

      armorSlotsDiv.appendChild(div);
    });
  }

  // Calculation function updated for Masterwork and tertiary mode
  function calculateStatsFromBuild() {
    const stats = {};
    STATS.forEach(s => stats[s] = 0);

    buildSlots.forEach(({ tier, archetype, tertiaryStat }) => {
      const primaryStat = ARCHETYPE_STATS[archetype].primary;
      const secondaryStat = ARCHETYPE_STATS[archetype].secondary;

      stats[primaryStat] += TIER_STATS[tier].primary;
      stats[secondaryStat] += TIER_STATS[tier].secondary;

      let tertiaryToUse = null;
      if (tertiaryMode === 'global') {
        tertiaryToUse = selectedGlobalTertiaryStat;
      } else {
        tertiaryToUse = tertiaryStat;
      }

      if (tertiaryToUse !== primaryStat && tertiaryToUse !== secondaryStat) {
        stats[tertiaryToUse] += TIER_STATS[tier].tertiary;
      } else {
        // fallback: distribute tertiary evenly across other stats excluding primary and secondary
        const tertiaryStats = STATS.filter(s => s !== primaryStat && s !== secondaryStat);
        const tertiaryPerStat = TIER_STATS[tier].tertiary / tertiaryStats.length;
        tertiaryStats.forEach(s => {
          stats[s] += tertiaryPerStat;
        });
      }

      // Masterwork bonus: +5 to the 3 stats NOT primary, secondary, or tertiary
      if (masterworkToggle.checked) {
        const excludedStats = [primaryStat, secondaryStat, tertiaryToUse];
        STATS.forEach(s => {
          if (!excludedStats.includes(s)) {
            stats[s] += 5;
          }
        });
      }
    });

    // Round all stats
    STATS.forEach(stat => {
      stats[stat] = Math.round(stats[stat]);
    });

    return stats;
  }

  // Update stats display
  function updateTotalStats() {
    const totals = calculateStatsFromBuild();
    const ul = document.getElementById('totalStats');
    ul.innerHTML = '';
    STATS.forEach(stat => {
      const li = document.createElement('li');
      li.textContent = `${stat}: ${totals[stat]}`;
      ul.appendChild(li);
    });
  }

  // Initialization
  initBuildSlots();
  renderArmorSlots();
  updateTotalStats();
  document.getElementById('globalTertiarySelector').style.display = 'block';

</script>

</body>
</html>
